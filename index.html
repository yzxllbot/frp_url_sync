<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>按需加载示例</title>
    <style>
        .container {
            margin: 20px;
            padding: 20px;
            max-width: 800px;
        }
        .load-btn {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .load-btn:hover {
            background-color: #45a049;
        }
        .load-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #history-content {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
        }
        .loading-text {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 跳转链接 -->
        <a href="/last_sync.html" class="link-button">
            查看最后一次同步结果
        </a>

        <!-- 加载控制区域 -->
        <div class="load-control" style="margin: 20px 0">
            <button class="load-btn" id="loadHistoryBtn">
                加载历史记录
            </button>
            <span id="loadingStatus" class="loading-text"></span>
        </div>

        <!-- 内容容器 -->
        <div id="history-content">
            <p class="loading-text">点击上方按钮加载历史记录</p>
        </div>
    </div>

    <script>
        (function() {
            // DOM元素引用
            const btn = document.getElementById('loadHistoryBtn');
            const container = document.getElementById('history-content');
            const status = document.getElementById('loadingStatus');
            
            // 加载状态管理
            let isLoading = false;

            // 按钮点击处理器
            function handleLoadClick() {
                if (isLoading) return;

                // 更新状态
                isLoading = true;
                btn.disabled = true;
                status.textContent = '数据加载中...';
                container.innerHTML = '<p class="loading-text">正在请求数据...</p>';

                // 创建请求对象
                const xhr = new XMLHttpRequest();
                xhr.open('GET', '/history.html', true);
                xhr.setRequestHeader('Content-Type', 'text/html');

                // 超时设置（5秒）
                xhr.timeout = 5000;

                // 响应处理器
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        container.innerHTML = xhr.responseText;
                        status.textContent = '数据加载完成';
                    } else {
                        container.innerHTML = `<p class="error-text">加载失败（状态码：${xhr.status}）</p>`;
                        status.textContent = '请求异常，请重试';
                    }
                    resetButton();
                };

                // 错误处理器
                xhr.onerror = function() {
                    container.innerHTML = '<p class="error-text">网络连接失败</p>';
                    status.textContent = '网络错误';
                    resetButton();
                };

                // 超时处理器
                xhr.ontimeout = function() {
                    container.innerHTML = '<p class="error-text">请求超时</p>';
                    status.textContent = '操作超时';
                    resetButton();
                };

                // 发送请求
                xhr.send();
            }

            // 重置按钮状态
            function resetButton() {
                isLoading = false;
                btn.disabled = false;
                setTimeout(() => {
                    status.textContent = '';
                }, 2000);
            }

            // 绑定事件
            btn.addEventListener('click', handleLoadClick);
        })();
    </script>
</body>
</html>